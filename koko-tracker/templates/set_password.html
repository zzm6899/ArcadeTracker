{% extends "base.html" %}
{% block title %}Set Password ‚Äì Balance Tracker{% endblock %}
{% block content %}
<div class="max-w-sm mx-auto mt-16">
    <div class="card rounded-2xl p-8">
        <div class="text-center mb-6">
            <div class="text-4xl mb-3">üîê</div>
            <h1 class="text-xl font-bold text-white">Set a Password</h1>
            <p class="text-slate-400 text-sm mt-1">
                Your account was created via Discord.<br>
                Set a password so you can also log in with your username.
            </p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}{% for cat, msg in messages %}
        <div class="mb-4 px-4 py-2.5 rounded-xl text-sm {% if cat == 'success' %}bg-green-900/30 border border-green-700 text-green-300{% else %}bg-red-900/30 border border-red-700 text-red-300{% endif %}">{{ msg }}</div>
        {% endfor %}{% endif %}{% endwith %}

        <form method="POST" class="space-y-4" onsubmit="return validateForm()">
            <div>
                <label class="block text-sm text-slate-400 mb-1">New Password</label>
                <input name="password" id="password" type="password" required autofocus
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    oninput="checkPassword(this.value)">
                <div class="mt-2 space-y-1">
                    <div class="flex items-center gap-2 text-xs">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-len">‚úó</span>
                        <span class="text-slate-500">At least 8 characters</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-upper">‚úó</span>
                        <span class="text-slate-500">One uppercase letter</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-num">‚úó</span>
                        <span class="text-slate-500">One number</span>
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm text-slate-400 mb-1">Confirm Password</label>
                <input name="confirm_password" id="confirm" type="password" required
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    oninput="checkMatch()">
                <p class="text-xs text-red-400 mt-1 hidden" id="match-err">Passwords don't match</p>
            </div>
            <button type="submit" id="submit-btn"
                class="btn-primary w-full py-2.5 rounded-lg text-sm font-medium text-white transition opacity-50 cursor-not-allowed"
                disabled>Set Password</button>
        </form>
        <p class="text-center text-sm text-slate-500 mt-4">
            <a href="/dashboard" class="text-slate-600 hover:text-slate-400">Skip for now</a>
        </p>
    </div>
</div>
<script>
function checkPassword(val) {
    const len = val.length >= 8, upper = /[A-Z]/.test(val), num = /[0-9]/.test(val);
    setCheck('len', len); setCheck('upper', upper); setCheck('num', num);
    document.getElementById('submit-btn').disabled = !(len && upper && num);
    document.getElementById('submit-btn').classList.toggle('opacity-50', !(len && upper && num));
    document.getElementById('submit-btn').classList.toggle('cursor-not-allowed', !(len && upper && num));
}
function setCheck(id, ok) {
    const icon = document.getElementById('icon-' + id);
    icon.textContent = ok ? '‚úì' : '‚úó';
    icon.className = `w-3.5 h-3.5 rounded-full border flex items-center justify-center text-[10px] ${ok ? 'border-green-500 text-green-400 bg-green-900/30' : 'border-slate-600 text-slate-500'}`;
}
function checkMatch() {
    const match = document.getElementById('password').value === document.getElementById('confirm').value;
    document.getElementById('match-err').classList.toggle('hidden', match || !document.getElementById('confirm').value);
}
function validateForm() {
    const pw = document.getElementById('password').value;
    const cm = document.getElementById('confirm').value;
    return pw === cm && pw.length >= 8 && /[A-Z]/.test(pw) && /[0-9]/.test(pw);
}
</script>
{% endblock %}
