{% extends "base.html" %}
{% block title %}Register â€“ Balance Tracker{% endblock %}
{% block content %}
<div class="max-w-sm mx-auto mt-16">
    <div class="card rounded-2xl p-8">
        <div class="text-center mb-6">
            <div class="text-4xl mb-3">ðŸŽ®</div>
            <h1 class="text-xl font-bold text-white">Create Account</h1>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}{% for cat, msg in messages %}
        <div class="mb-4 px-4 py-2.5 rounded-xl text-sm {% if cat == 'success' %}bg-green-900/30 border border-green-700 text-green-300{% else %}bg-red-900/30 border border-red-700 text-red-300{% endif %}">{{ msg }}</div>
        {% endfor %}{% endif %}{% endwith %}

        <form method="POST" class="space-y-4" onsubmit="return validateForm()">
            <div>
                <label class="block text-sm text-slate-400 mb-1">Username</label>
                <input name="username" id="username" type="text" required autofocus
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="your username"
                    minlength="3" maxlength="30">
            </div>
            <div>
                <label class="block text-sm text-slate-400 mb-1">Email <span class="text-slate-600">(for password reset)</span></label>
                <input name="email" id="email" type="email"
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="you@example.com">
                <p class="text-xs text-slate-600 mt-1">Optional but required for password reset</p>
            </div>
            <div>
                <label class="block text-sm text-slate-400 mb-1">Password</label>
                <input name="password" id="password" type="password" required
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                    oninput="checkPassword(this.value)">
                <!-- Password strength indicators -->
                <div class="mt-2 space-y-1" id="pw-checks">
                    <div class="flex items-center gap-2 text-xs" id="check-len">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-len">âœ—</span>
                        <span class="text-slate-500">At least 8 characters</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs" id="check-upper">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-upper">âœ—</span>
                        <span class="text-slate-500">One uppercase letter</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs" id="check-num">
                        <span class="w-3.5 h-3.5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]" id="icon-num">âœ—</span>
                        <span class="text-slate-500">One number</span>
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm text-slate-400 mb-1">Confirm Password</label>
                <input name="confirm_password" id="confirm" type="password" required
                    class="input-field w-full px-4 py-2.5 rounded-lg text-sm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                    oninput="checkMatch()">
                <p class="text-xs text-red-400 mt-1 hidden" id="match-err">Passwords don't match</p>
            </div>
            <button type="submit" id="submit-btn"
                class="btn-primary w-full py-2.5 rounded-lg text-sm font-medium text-white transition opacity-50 cursor-not-allowed"
                disabled>
                Create Account
            </button>
        </form>
        <p class="text-center text-sm text-slate-500 mt-4">
            Already have an account? <a href="/login" class="text-indigo-400 hover:text-indigo-300">Sign in</a>
        </p>
    </div>
</div>
<script>
function checkPassword(val) {
    const len   = val.length >= 8;
    const upper = /[A-Z]/.test(val);
    const num   = /[0-9]/.test(val);
    setCheck('len', len);
    setCheck('upper', upper);
    setCheck('num', num);
    updateSubmit(len && upper && num);
}
function setCheck(id, ok) {
    const icon = document.getElementById('icon-' + id);
    icon.textContent = ok ? 'âœ“' : 'âœ—';
    icon.className = `w-3.5 h-3.5 rounded-full border flex items-center justify-center text-[10px] ${ok ? 'border-green-500 text-green-400 bg-green-900/30' : 'border-slate-600 text-slate-500'}`;
}
function checkMatch() {
    const pw = document.getElementById('password').value;
    const cm = document.getElementById('confirm').value;
    const err = document.getElementById('match-err');
    err.classList.toggle('hidden', pw === cm || cm === '');
}
function updateSubmit(pwOk) {
    const btn = document.getElementById('submit-btn');
    btn.disabled = !pwOk;
    btn.classList.toggle('opacity-50', !pwOk);
    btn.classList.toggle('cursor-not-allowed', !pwOk);
}
function validateForm() {
    const pw = document.getElementById('password').value;
    const cm = document.getElementById('confirm').value;
    if (pw !== cm) { document.getElementById('match-err').classList.remove('hidden'); return false; }
    if (pw.length < 8 || !/[A-Z]/.test(pw) || !/[0-9]/.test(pw)) return false;
    return true;
}
</script>
{% endblock %}
